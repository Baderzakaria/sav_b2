{"spans": [{"trace_id": "6HNxxiDj9+qfVOhYK/9r0Q==", "span_id": "rRh/tCLMUTc=", "trace_state": "", "parent_span_id": "", "name": "LangGraph", "start_time_unix_nano": 1763534055725331150, "end_time_unix_nano": 1763534062694128770, "attributes": {"mlflow.traceRequestId": "\"750276d8dc4f48f38b49441b3e7a2ed6\"", "mlflow.spanOutputs": "{\"full_text\": \"Un incident sur nos fibres engendre des perturbations de service sur une partie des départements du Lot (46) et de l'Aveyron (12).\\\\nDes investigations sont en cours, merci de votre patience.\", \"a1_result\": \"JSON: {\\\"useful\\\": true}\", \"a2_result\": \"JSON réponse :\\n{\\n  \\\"categorie\\\": \\\"probleme\\\"\\n}\", \"a3_result\": \"{\\\"sentiment\\\": \\\"colere\\\"}\", \"a4_result\": \"Bonjour!\\n\\nEn tant qu'Agent A4, je vous indique que le problème type est \\\"abonnement\\\".\\n\\nVoici la réponse JSON :\\n\\n```json\\n{\\n  \\\"type_probleme\\\": \\\"abonnement\\\"\\n}\\n```\\n\\nEt voici un tweet pour informer les utilisateurs de l'état du service :\\n\\n\\\"Alerte ! Un incident sur nos fibres engendre des perturbations de service dans certains départements. Le Lot (46) et l'Aveyron (12) sont touchés. Des investigations sont en cours, nous vous remercions de votre patience. #ServiceEnCours #RéparationEnMarche\\\"\", \"a5_result\": \"JSON: {\\\"score_gravite\\\": -5}\\n\\nTweet : \\\"Alerte : incident sur les fibres nous affectant les départements du Lot et de l'Aveyron. En cours d'enquête, patientez s'il vous plaît.\\\"\", \"final_json\": {\"status\": \"error\", \"raw_response\": \"import json\\n\\n# Input dictionary\\ninputs = {\\n    \\\"A1\\\": \\\"JSON: {\\\\\\\"useful\\\\\\\": true}\\\",\\n    \\\"A2\\\": \\\"JSON r\\\\u00e9ponse :\\\\n{\\\\n  \\\\\\\"categorie\\\\\\\": \\\\\\\"probleme\\\\\\\"\\\\n}\\\",\\n    \\\"A3\\\": \\\"{\\\\\\\"sentiment\\\\\\\": \\\\\\\"colere\\\\\\\"}\\\",\\n    \\\"A4\\\": \\\"Bonjour!\\\\n\\\\nEn tant qu'Agent A4, je vous indique que le probl\\\\u00e8me type est \\\\\\\"abonnement\\\\\\\".\\\\n\\\\nVoici la r\\\\u00e9ponse JSON :\\\\n\\\\n```json\\\\n{\\\\n  \\\\\\\"type_probleme\\\\\\\": \\\\\\\"abonnement\\\\\\\"\\\\n}\\\\n```\\\\n\\\\nEt voici un tweet pour informer les utilisateurs de l'\\\\u00e9tat du service :\\\\n\\\\n\\\\\\\"Alerte ! Un incident sur nos fibres engendre des perturbations de service dans certains d\\\\u00eépartements. Le Lot (46) et l'Aveyron (12) sont touch\\\\u00e9s. Des investigations sont en cours, nous vous remercions de votre patience. #ServiceEnCours #R\\\\u00e9parationEnMarche\\\\\\\"\\\",\\n    \\\"A5\\\": \\\"JSON: {\\\\\\\"score_gravite\\\\\\\": -5}\\\\n\\\\nTweet : \\\\\\\"Alerte : incident sur les fibres nous affectant les d\\\\u00e9partements du Lot et de l'Aveyron. En cours d'enqu\\\\u00eate, patientez s'il vous pla\\\\u00eet.\\\\\\\"\\\"\\n}\\n\\n# Consensus\\nconsensus = True\\n\\n# Validation des valeurs JSON\\ndef validate_json(json_str):\\n    try:\\n        return json.loads(json_str)\\n    except json.JSONDecodeError:\\n        return False\\n\\ndef compare_gravite(score_gravite):\\n    if score_gravite >= 0:\\n        return \\\"High\\\"\\n    elif score_gravite < 0:\\n        return \\\"Low\\\"\\n    else:\\n        return \\\"Low\\\"\\n\\n# Consensus des valeurs\\nfor key, value in inputs.items():\\n    json_str, tweet = value.split(\\\"\\\\n\\\\n\\\")\\n    \\n    # Validation du JSON\\n    json_valid = validate_json(json_str)\\n    if not json_valid:\\n        consensus = False\\n        continue\\n\\n    # Recherche de la clé 'utile'\\n    utile_key = list(json_valid.keys())[0]\\n    if utile_key == \\\"useful\\\":\\n        utile = json_valid[utile_key] == True\\n    elif utile_key == \\\"categorie\\\" or utile_key == \\\"sentiment\\\":\\n        # La clé n'est pas 'utile', mais le problème est validé, donc le consensus reste le même\\n        continue\\n\\n    if key == \\\"A1\\\":\\n        score_gravite = json_valid[\\\"score_gravite\\\"]\\n    else:\\n        score_gravite = validate_json(tweet)\\n    \\n    if not compare_gravite(score_gravite):\\n        consensus = False\\n        break\\n\\n# Construction du résultat\\nresult = {\\n    \\\"utile\\\": utile,\\n    \\\"categorie\\\": json_valid.get(\\\"categorie\\\", \\\"\\\"),\\n    \\\"sentiment\\\": json_valid.get(\\\"sentiment\\\", \\\"\\\"),\\n    \\\"type_probleme\\\": json_valid[\\\"type_probleme\\\"],\\n    \\\"score_gravite\\\": score_gravite if compare_gravite(score_gravite) != 'Low' else 0,\\n    \\\"status\\\": \\\"success\\\" if consensus else \\\"error\\\"\\n}\\n\\nprint(json.dumps(result, indent=4))\"}}", "mlflow.spanInputs": "{\"full_text\": \"Un incident sur nos fibres engendre des perturbations de service sur une partie des départements du Lot (46) et de l'Aveyron (12).\\\\nDes investigations sont en cours, merci de votre patience.\"}", "mlflow.spanType": "\"CHAIN\""}, "status": {"message": "", "code": "STATUS_CODE_OK"}}, {"trace_id": "6HNxxiDj9+qfVOhYK/9r0Q==", "span_id": "lmhYCebywJw=", "trace_state": "", "parent_span_id": "rRh/tCLMUTc=", "name": "A1", "start_time_unix_nano": 1763534055727188710, "end_time_unix_nano": 1763534056110971262, "attributes": {"metadata": "{\"langgraph_step\": 1, \"langgraph_node\": \"A1\", \"langgraph_triggers\": [\"branch:to:A1\"], \"langgraph_path\": [\"__pregel_pull\", \"A1\"], \"langgraph_checkpoint_ns\": \"A1:9a0f7f57-c75a-cce6-c72f-25c424f64cd8\"}", "mlflow.traceRequestId": "\"750276d8dc4f48f38b49441b3e7a2ed6\"", "mlflow.spanOutputs": "{\"a1_result\": \"JSON: {\\\"useful\\\": true}\"}", "mlflow.spanInputs": "{\"full_text\": \"Un incident sur nos fibres engendre des perturbations de service sur une partie des départements du Lot (46) et de l'Aveyron (12).\\\\nDes investigations sont en cours, merci de votre patience.\"}", "mlflow.spanType": "\"CHAIN\""}, "status": {"message": "", "code": "STATUS_CODE_OK"}}, {"trace_id": "6HNxxiDj9+qfVOhYK/9r0Q==", "span_id": "n1PY2R15Ggc=", "trace_state": "", "parent_span_id": "rRh/tCLMUTc=", "name": "A2", "start_time_unix_nano": 1763534055728308985, "end_time_unix_nano": 1763534056036632519, "attributes": {"metadata": "{\"langgraph_step\": 1, \"langgraph_node\": \"A2\", \"langgraph_triggers\": [\"branch:to:A2\"], \"langgraph_path\": [\"__pregel_pull\", \"A2\"], \"langgraph_checkpoint_ns\": \"A2:1b5eb619-6203-ac21-2ca5-029f3ce6c4c5\"}", "mlflow.traceRequestId": "\"750276d8dc4f48f38b49441b3e7a2ed6\"", "mlflow.spanOutputs": "{\"a2_result\": \"JSON réponse :\\n{\\n  \\\"categorie\\\": \\\"probleme\\\"\\n}\"}", "mlflow.spanInputs": "{\"full_text\": \"Un incident sur nos fibres engendre des perturbations de service sur une partie des départements du Lot (46) et de l'Aveyron (12).\\\\nDes investigations sont en cours, merci de votre patience.\"}", "mlflow.spanType": "\"CHAIN\""}, "status": {"message": "", "code": "STATUS_CODE_OK"}}, {"trace_id": "6HNxxiDj9+qfVOhYK/9r0Q==", "span_id": "f65QhcEs0yY=", "trace_state": "", "parent_span_id": "rRh/tCLMUTc=", "name": "A3", "start_time_unix_nano": 1763534055731981155, "end_time_unix_nano": 1763534056183273700, "attributes": {"metadata": "{\"langgraph_step\": 1, \"langgraph_node\": \"A3\", \"langgraph_triggers\": [\"branch:to:A3\"], \"langgraph_path\": [\"__pregel_pull\", \"A3\"], \"langgraph_checkpoint_ns\": \"A3:94c49169-05ad-b7bb-3260-999c5d1c2f31\"}", "mlflow.traceRequestId": "\"750276d8dc4f48f38b49441b3e7a2ed6\"", "mlflow.spanOutputs": "{\"a3_result\": \"{\\\"sentiment\\\": \\\"colere\\\"}\"}", "mlflow.spanInputs": "{\"full_text\": \"Un incident sur nos fibres engendre des perturbations de service sur une partie des départements du Lot (46) et de l'Aveyron (12).\\\\nDes investigations sont en cours, merci de votre patience.\"}", "mlflow.spanType": "\"CHAIN\""}, "status": {"message": "", "code": "STATUS_CODE_OK"}}, {"trace_id": "6HNxxiDj9+qfVOhYK/9r0Q==", "span_id": "r074ImWUp5w=", "trace_state": "", "parent_span_id": "rRh/tCLMUTc=", "name": "A4", "start_time_unix_nano": 1763534055734163593, "end_time_unix_nano": 1763534057097391234, "attributes": {"metadata": "{\"langgraph_step\": 1, \"langgraph_node\": \"A4\", \"langgraph_triggers\": [\"branch:to:A4\"], \"langgraph_path\": [\"__pregel_pull\", \"A4\"], \"langgraph_checkpoint_ns\": \"A4:2dfeaa05-c6bc-eef2-a1e9-e2ac5d5f957b\"}", "mlflow.traceRequestId": "\"750276d8dc4f48f38b49441b3e7a2ed6\"", "mlflow.spanOutputs": "{\"a4_result\": \"Bonjour!\\n\\nEn tant qu'Agent A4, je vous indique que le problème type est \\\"abonnement\\\".\\n\\nVoici la réponse JSON :\\n\\n```json\\n{\\n  \\\"type_probleme\\\": \\\"abonnement\\\"\\n}\\n```\\n\\nEt voici un tweet pour informer les utilisateurs de l'état du service :\\n\\n\\\"Alerte ! Un incident sur nos fibres engendre des perturbations de service dans certains départements. Le Lot (46) et l'Aveyron (12) sont touchés. Des investigations sont en cours, nous vous remercions de votre patience. #ServiceEnCours #RéparationEnMarche\\\"\"}", "mlflow.spanInputs": "{\"full_text\": \"Un incident sur nos fibres engendre des perturbations de service sur une partie des départements du Lot (46) et de l'Aveyron (12).\\\\nDes investigations sont en cours, merci de votre patience.\"}", "mlflow.spanType": "\"CHAIN\""}, "status": {"message": "", "code": "STATUS_CODE_OK"}}, {"trace_id": "6HNxxiDj9+qfVOhYK/9r0Q==", "span_id": "+95zGgbknow=", "trace_state": "", "parent_span_id": "rRh/tCLMUTc=", "name": "A5", "start_time_unix_nano": 1763534055736362642, "end_time_unix_nano": 1763534057462692660, "attributes": {"metadata": "{\"langgraph_step\": 1, \"langgraph_node\": \"A5\", \"langgraph_triggers\": [\"branch:to:A5\"], \"langgraph_path\": [\"__pregel_pull\", \"A5\"], \"langgraph_checkpoint_ns\": \"A5:1cbb3971-3739-f409-dce5-6edf304a85d4\"}", "mlflow.traceRequestId": "\"750276d8dc4f48f38b49441b3e7a2ed6\"", "mlflow.spanOutputs": "{\"a5_result\": \"JSON: {\\\"score_gravite\\\": -5}\\n\\nTweet : \\\"Alerte : incident sur les fibres nous affectant les départements du Lot et de l'Aveyron. En cours d'enquête, patientez s'il vous plaît.\\\"\"}", "mlflow.spanInputs": "{\"full_text\": \"Un incident sur nos fibres engendre des perturbations de service sur une partie des départements du Lot (46) et de l'Aveyron (12).\\\\nDes investigations sont en cours, merci de votre patience.\"}", "mlflow.spanType": "\"CHAIN\""}, "status": {"message": "", "code": "STATUS_CODE_OK"}}, {"trace_id": "6HNxxiDj9+qfVOhYK/9r0Q==", "span_id": "dgrKTXJ1j7E=", "trace_state": "", "parent_span_id": "rRh/tCLMUTc=", "name": "A6", "start_time_unix_nano": 1763534057463847236, "end_time_unix_nano": 1763534062693478785, "attributes": {"metadata": "{\"langgraph_step\": 2, \"langgraph_node\": \"A6\", \"langgraph_triggers\": [\"branch:to:A6\"], \"langgraph_path\": [\"__pregel_pull\", \"A6\"], \"langgraph_checkpoint_ns\": \"A6:0eb8e6ee-77f3-3284-b804-7c8c7020563a\"}", "mlflow.traceRequestId": "\"750276d8dc4f48f38b49441b3e7a2ed6\"", "mlflow.spanOutputs": "{\"final_json\": {\"status\": \"error\", \"raw_response\": \"import json\\n\\n# Input dictionary\\ninputs = {\\n    \\\"A1\\\": \\\"JSON: {\\\\\\\"useful\\\\\\\": true}\\\",\\n    \\\"A2\\\": \\\"JSON r\\\\u00e9ponse :\\\\n{\\\\n  \\\\\\\"categorie\\\\\\\": \\\\\\\"probleme\\\\\\\"\\\\n}\\\",\\n    \\\"A3\\\": \\\"{\\\\\\\"sentiment\\\\\\\": \\\\\\\"colere\\\\\\\"}\\\",\\n    \\\"A4\\\": \\\"Bonjour!\\\\n\\\\nEn tant qu'Agent A4, je vous indique que le probl\\\\u00e8me type est \\\\\\\"abonnement\\\\\\\".\\\\n\\\\nVoici la r\\\\u00e9ponse JSON :\\\\n\\\\n```json\\\\n{\\\\n  \\\\\\\"type_probleme\\\\\\\": \\\\\\\"abonnement\\\\\\\"\\\\n}\\\\n```\\\\n\\\\nEt voici un tweet pour informer les utilisateurs de l'\\\\u00e9tat du service :\\\\n\\\\n\\\\\\\"Alerte ! Un incident sur nos fibres engendre des perturbations de service dans certains d\\\\u00eépartements. Le Lot (46) et l'Aveyron (12) sont touch\\\\u00e9s. Des investigations sont en cours, nous vous remercions de votre patience. #ServiceEnCours #R\\\\u00e9parationEnMarche\\\\\\\"\\\",\\n    \\\"A5\\\": \\\"JSON: {\\\\\\\"score_gravite\\\\\\\": -5}\\\\n\\\\nTweet : \\\\\\\"Alerte : incident sur les fibres nous affectant les d\\\\u00e9partements du Lot et de l'Aveyron. En cours d'enqu\\\\u00eate, patientez s'il vous pla\\\\u00eet.\\\\\\\"\\\"\\n}\\n\\n# Consensus\\nconsensus = True\\n\\n# Validation des valeurs JSON\\ndef validate_json(json_str):\\n    try:\\n        return json.loads(json_str)\\n    except json.JSONDecodeError:\\n        return False\\n\\ndef compare_gravite(score_gravite):\\n    if score_gravite >= 0:\\n        return \\\"High\\\"\\n    elif score_gravite < 0:\\n        return \\\"Low\\\"\\n    else:\\n        return \\\"Low\\\"\\n\\n# Consensus des valeurs\\nfor key, value in inputs.items():\\n    json_str, tweet = value.split(\\\"\\\\n\\\\n\\\")\\n    \\n    # Validation du JSON\\n    json_valid = validate_json(json_str)\\n    if not json_valid:\\n        consensus = False\\n        continue\\n\\n    # Recherche de la clé 'utile'\\n    utile_key = list(json_valid.keys())[0]\\n    if utile_key == \\\"useful\\\":\\n        utile = json_valid[utile_key] == True\\n    elif utile_key == \\\"categorie\\\" or utile_key == \\\"sentiment\\\":\\n        # La clé n'est pas 'utile', mais le problème est validé, donc le consensus reste le même\\n        continue\\n\\n    if key == \\\"A1\\\":\\n        score_gravite = json_valid[\\\"score_gravite\\\"]\\n    else:\\n        score_gravite = validate_json(tweet)\\n    \\n    if not compare_gravite(score_gravite):\\n        consensus = False\\n        break\\n\\n# Construction du résultat\\nresult = {\\n    \\\"utile\\\": utile,\\n    \\\"categorie\\\": json_valid.get(\\\"categorie\\\", \\\"\\\"),\\n    \\\"sentiment\\\": json_valid.get(\\\"sentiment\\\", \\\"\\\"),\\n    \\\"type_probleme\\\": json_valid[\\\"type_probleme\\\"],\\n    \\\"score_gravite\\\": score_gravite if compare_gravite(score_gravite) != 'Low' else 0,\\n    \\\"status\\\": \\\"success\\\" if consensus else \\\"error\\\"\\n}\\n\\nprint(json.dumps(result, indent=4))\"}}", "mlflow.spanInputs": "{\"full_text\": \"Un incident sur nos fibres engendre des perturbations de service sur une partie des départements du Lot (46) et de l'Aveyron (12).\\\\nDes investigations sont en cours, merci de votre patience.\", \"a1_result\": \"JSON: {\\\"useful\\\": true}\", \"a2_result\": \"JSON réponse :\\n{\\n  \\\"categorie\\\": \\\"probleme\\\"\\n}\", \"a3_result\": \"{\\\"sentiment\\\": \\\"colere\\\"}\", \"a4_result\": \"Bonjour!\\n\\nEn tant qu'Agent A4, je vous indique que le problème type est \\\"abonnement\\\".\\n\\nVoici la réponse JSON :\\n\\n```json\\n{\\n  \\\"type_probleme\\\": \\\"abonnement\\\"\\n}\\n```\\n\\nEt voici un tweet pour informer les utilisateurs de l'état du service :\\n\\n\\\"Alerte ! Un incident sur nos fibres engendre des perturbations de service dans certains départements. Le Lot (46) et l'Aveyron (12) sont touchés. Des investigations sont en cours, nous vous remercions de votre patience. #ServiceEnCours #RéparationEnMarche\\\"\", \"a5_result\": \"JSON: {\\\"score_gravite\\\": -5}\\n\\nTweet : \\\"Alerte : incident sur les fibres nous affectant les départements du Lot et de l'Aveyron. En cours d'enquête, patientez s'il vous plaît.\\\"\"}", "mlflow.spanType": "\"CHAIN\""}, "status": {"message": "", "code": "STATUS_CODE_OK"}}]}